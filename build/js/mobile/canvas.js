function fit(a,b,c){var d=b.clientWidth,e=b.clientHeight,f=0,g=0,h=d,i=e,j=a.style;isFinite(c)&&(d/e>c?(h=e*c|0,f=d-h>>1):(i=d/c|0,g=e-i>>1)),j.left=f+"px",j.top=g+"px",j.width=h+"px",j.height=i+"px"}function fSpinText(a,b,c,d,e,f){var g=d/2;a.setTransform(1,0,0,1,0,0),a.translate(b+g,c+g),a.rotate(e),fillTextLine(f,-g,-g),a.setTransform(1,0,0,1,0,0),a.translate(-(b+g),-(c+g)),a.rotate(-e)}function initCanvas(){$(window).on("orientationchange",resizeCanvas),$(window).on("resize",resizeCanvas),canvas=document.createElement("canvas"),canvas.width=canvasWidth,canvas.height=canvasHeight,canvas.addEventListener("touchstart",canvasTouchStart,!1),canvas.addEventListener("touchend",canvasTouchEnd,!1),document.body.appendChild(canvas),fit(canvas,canvas.parentNode,canvas.width/canvas.height),ctx=canvas.getContext("2d"),loopCanvas()}function canvasTouchStart(){socket.emit("report_motion",{id:id,roomid:roomid,e:"canvas.touchstart"})}function canvasTouchEnd(){socket.emit("report_motion",{id:id,roomid:roomid,e:"canvas.touchend"})}function loopCanvas(){updateCanvas()&&drawCanvas()}function updateCanvas(){return!0}function drawCanvas(){ctx.moveTo(0,0),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="white",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.strokeStyle="red",ctx.moveTo(10,10),ctx.lineTo(canvasWidth-10,(canvasWidth-10)*canvasHeightScale),ctx.stroke(),ctx.fillStyle="black",ctx.font="60px sans-serif",ctx.textAlign="center",fSpinText(ctx,canvasWidth/4*3,canvasHeight/2,60,90*Math.PI/180,"画面縦向きロックを有効にして、\nこの部分を上にして持ちます\n\n画面をタップし続けて前進、\nモバイルを左右に傾けて操作します"),ctx.moveTo(0,0),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="white",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.strokeStyle="bule",ctx.moveTo(10,10),ctx.lineTo(canvasWidth-10,(canvasWidth-10)*canvasHeightScale),ctx.stroke()}function landscaped(){waitingLandscape=!1}function resizeCanvas(){fit(canvas,canvas.parentNode,canvas.width/canvas.height)}function fit(a,b,c){var d=b.clientWidth,e=b.clientHeight,f=0,g=0,h=d,i=e,j=a.style;isFinite(c)&&(d/e>c?(h=e*c|0,f=d-h>>1):(i=d/c|0,g=e-i>>1)),j.left=f+"px",j.top=g+"px",j.width=h+"px",j.height=i+"px"}function initCanvas(){$(window).on("orientationchange",resizeCanvas),$(window).on("resize",resizeCanvas),canvas=document.createElement("canvas"),canvas.width=canvasWidth,canvas.height=canvasHeight,canvas.addEventListener("touchstart",canvasTouchStart,!1),canvas.addEventListener("touchend",canvasTouchEnd,!1),document.body.appendChild(canvas),fit(canvas,canvas.parentNode,canvas.width/canvas.height),ctx=canvas.getContext("2d"),descImage.src="images/mobile-hands.png",runningImage.src="images/runningImage.png",onTouchImage.src="images/onTouchImage.png",setInterval(loopCanvas,1e3/30),loopCanvas()}function canvasTouchStart(){istouch=!0,socket.emit("report_motion",{id:id,roomid:roomid,e:"canvas.touchstart"})}function canvasTouchEnd(){istouch=!1,socket.emit("report_motion",{id:id,roomid:roomid,e:"canvas.touchend"})}function loopCanvas(){updateCanvas()&&drawCanvas(),loopcount++}function updateCanvas(){return reportMotionLast(),!0}function drawCanvas(){ctx.moveTo(0,0),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="white",ctx.fillRect(0,0,canvas.width,canvas.height);var a=!1;90>loopcount?(a=!0,ctx.drawImage(descImage,0,0,canvasWidth,canvasHeight)):istouch?(a=!0,ctx.drawImage(onTouchImage,0,0,canvasWidth,canvasHeight)):(a=!0,ctx.drawImage(runningImage,0,0,canvasWidth,canvasHeight))}function landscaped(){waitingLandscape=!1}function resizeCanvas(){fit(canvas,canvas.parentNode,canvas.width/canvas.height)}var initedCanvas=!1,canvas,ctx,canvasWidth=1e3,canvasHeightScale=1/3*4,canvasHeight=canvasWidth*canvasHeightScale,waitingLandscape=!1,fillTextLine=function(a,b,c){var d=a.split("\n"),e=ctx.measureText("あ").width;d.forEach(function(a,d){ctx.fillText(a,b,c+1.5*e*d)})},initedCanvas=!1,canvas,ctx,canvasWidth=1e3,canvasHeightScale=1/3*4,canvasHeight=canvasWidth*canvasHeightScale,waitingLandscape=!1,istouch=!1,descImage=new Image,runningImage=new Image,onTouchImage=new Image,fillTextLine=function(a,b,c){var d=a.split("\n"),e=ctx.measureText("あ").width;d.forEach(function(a,d){ctx.fillText(a,b,c+1.5*e*d)})},loopcount=0;
//# sourceMappingURL=canvas.map