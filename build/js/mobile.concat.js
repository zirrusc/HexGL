function fit(a,b,c){var d=b.clientWidth,e=b.clientHeight,f=0,g=0,h=d,i=e,j=a.style;isFinite(c)&&(d/e>c?(h=e*c|0,f=d-h>>1):(i=d/c|0,g=e-i>>1)),j.left=f+"px",j.top=g+"px",j.width=h+"px",j.height=i+"px"}function initCanvas(){$(window).on("orientationchange",resizeCanvas),$(window).on("resize",resizeCanvas),canvas=document.createElement("canvas"),canvas.width=canvasWidth,canvas.height=canvasHeight,canvas.addEventListener("touchstart",canvasTouchStart,!1),canvas.addEventListener("touchend",canvasTouchEnd,!1),document.body.appendChild(canvas),fit(canvas,canvas.parentNode,canvas.width/canvas.height),ctx=canvas.getContext("2d"),descImage.src="images/mobile-hands.png",runningImage.src="images/runningImage.png",onTouchImage.src="images/onTouchImage.png",setInterval(loopCanvas,1e3/30),loopCanvas()}function canvasTouchStart(){istouch=!0,socket.emit("report_motion",{id:id,roomid:roomid,e:"canvas.touchstart"})}function canvasTouchEnd(){istouch=!1,socket.emit("report_motion",{id:id,roomid:roomid,e:"canvas.touchend"})}function loopCanvas(){updateCanvas()&&drawCanvas(),loopcount++}function updateCanvas(){return reportMotionLast(),!0}function drawCanvas(){ctx.moveTo(0,0),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="white",ctx.fillRect(0,0,canvas.width,canvas.height);var a=!1;90>loopcount?(a=!0,ctx.drawImage(descImage,0,0,canvasWidth,canvasHeight)):istouch?(a=!0,ctx.drawImage(onTouchImage,0,0,canvasWidth,canvasHeight)):(a=!0,ctx.drawImage(runningImage,0,0,canvasWidth,canvasHeight))}function landscaped(){waitingLandscape=!1}function resizeCanvas(){fit(canvas,canvas.parentNode,canvas.width/canvas.height)}var initedCanvas=!1,canvas,ctx,canvasWidth=1e3,canvasHeightScale=1/3*4,canvasHeight=canvasWidth*canvasHeightScale,waitingLandscape=!1,istouch=!1,descImage=new Image,runningImage=new Image,onTouchImage=new Image,fillTextLine=function(a,b,c){var d=a.split("\n"),e=ctx.measureText("あ").width;d.forEach(function(a,d){ctx.fillText(a,b,c+1.5*e*d)})},loopcount=0;
//# sourceMappingURL=canvas.map
function hashArgs(){for(var a,b=new Object,c=window.location.search.substring(1).split("&"),d=0;d<c.length;d++)a=c[d].split("="),b[a[0]]=a[1];return b}function initSocket(){socket=io.connect(),socket.on("added_room_mobile"+id,function(a){console.log("received",a),roomid=a.roomid,$("#pinBox").hide(),authoricated=!0,$(".modal-backdrop").remove(),0==initedCanvas&&(initCanvas(),initedCanvas=!0)}),socket.on("failed_add_room_mobile"+id,function(){location.href="/mobile.html?invalid_pin=1"}),socket.on("start",function(){console.log("STARTED"),started=!0}),socket.on("ping",function(a){socket.emit("ping_return",{id:id,roomid:a.roomid,time:a.time})})}function reportMotion(){authoricated&&(last_orientation_event=event,reportMotionBase(event,"window.ondeviceorientation"))}function reportMotionLast(){void 0!=lastEvent&&reportMotionBase(lastEvent,"reportMotionLast")}function reportMotionBase(a,b){if(authoricated){lastEvent=a;var c={id:id,roomid:roomid,y:a.beta,e:b};"reportMotionLast"==b&&(c.touch=istouch),socket.emit("report_motion",c)}waitingLandscape&&a.gamma>45&&a.gamma<135&&landscaped()}var id=String(Math.floor(1e6*Math.random())),roomid,socket,ready=!1,authoricated=!1,supportsTouchend=!1,base_x=0,last_orientation_event,started=!1,lastEvent;
//# sourceMappingURL=motion.map
function initPinBox(){$("#pinBoxOk").bind("touchend",sendAddRequest),$("#pinBoxOk").bind("click",sendAddRequestOnClick),$("#pinBox").modal("show"),$("#pinBoxValue").text(""),$("#pinBoxValue").focus(),window.ondeviceorientation=reportMotion}function sendAddRequest(){supportsTouchend=!0;var a=$("#pinBoxValue").val().replace(" ","");ready&&socket.emit("add_room_mobile",{id:id,roomid:a})}function sendAddRequestOnClick(){0==supportsTouchend&&sendAddRequest()}function preventTouchEvents(){function a(a){a.preventDefault()}$(document).bind("touchmove",a),$(document).bind("gesturestart",a),$(document).bind("gesturechange",a),$(document).bind("gestureend",a)}$(function(){var a=hashArgs();initSocket(),window.scrollTo(0,1),preventTouchEvents(),1==a.invalid_pin&&($("#pinBoxAdvice").show(),$("#pinBoxAdvice").text("Pin が違うよ")),initPinBox(),ready=!0});
//# sourceMappingURL=mobile.map