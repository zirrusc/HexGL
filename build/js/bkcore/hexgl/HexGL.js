"use strict";"v1.0.1";var bkcore=bkcore||{};bkcore.hexgl=bkcore.hexgl||{},bkcore.hexgl.HexGL=function(a){function b(a){27==a.keyCode&&c.reset()}var c=this;this.document=a.document||document,this.a=window.location.href,this.active=!0,this.width=void 0==a.width?window.innerWidth:a.width,this.height=void 0==a.height?window.innerHeight:a.height,this.quality=void 0==a.quality?2:a.quality,this.difficulty=void 0==a.difficulty?0:a.difficulty,this.player=void 0==a.player?"Anonym":a.player,this.half=void 0==a.half?!1:a.half,this.track=bkcore.hexgl.tracks[void 0==a.track?"Cityscape":a.track],this.half&&(this.width/=2,this.height/=2),this.settings=null,this.renderer=null,this.manager=null,this.lib=null,this.materials={},this.components={},this.extras={vignetteColor:new THREE.Color(4557489),bloom:null,fxaa:null},this.containers={},this.containers.main=void 0==a.container?document.body:a.container,this.containers.overlay=void 0==a.overlay?document.body:a.overlay,this.hud=null,this.gameplay=null,this.composers={game:null},this.initRenderer(),this.document.addEventListener("keydown",b,!1)},bkcore.hexgl.HexGL.prototype.start=function(){function a(){requestAnimationFrame(a),b.update()}this.manager.setCurrent("game");var b=this;a(),this.initGameplay()},bkcore.hexgl.HexGL.prototype.reset=function(){this.manager.get("game").objects.lowFPS=0,this.gameplay.start()},bkcore.hexgl.HexGL.prototype.restart=function(){this.document.getElementById("finish").style.display="none",this.reset()},bkcore.hexgl.HexGL.prototype.update=function(){this.active&&(null!=this.gameplay&&this.gameplay.update(),this.manager.renderCurrent())},bkcore.hexgl.HexGL.prototype.init=function(){this.initHUD(),this.track.buildMaterials(this.quality),this.track.buildScenes(this,this.quality),this.initGameComposer()},bkcore.hexgl.HexGL.prototype.load=function(a){this.track.load(a,this.quality)},bkcore.hexgl.HexGL.prototype.initGameplay=function(){var a=this;this.gameplay=new bkcore.hexgl.Gameplay({mode:"timeattack",hud:this.hud,shipControls:this.components.shipControls,analyser:this.track.analyser,pixelRatio:this.track.pixelRatio,track:{checkpoints:this.track.checkpoints,spawn:this.track.spawn,spawnRotation:this.track.spawnRotation},onFinish:function(){a.displayScore(this.finishTime,this.lapTimes)}}),this.gameplay.start()},bkcore.hexgl.HexGL.prototype.displayScore=function(a,b){var c="cityscape",d=this.document.getElementById("finish"),e=this.document.getElementById("finish-state"),f=this.document.getElementById("finish-hallmsg"),g=this.document.getElementById("finish-msg"),h=this.document.getElementById("finish-result"),i=this.document.getElementById("finish-lap1"),j=this.document.getElementById("finish-lap2"),k=this.document.getElementById("finish-lap3"),l=this.document.getElementById("finish-diff"),m=this.document.getElementById("finish-twitter"),n=this.document.getElementById("finish-fb"),o=this.document.getElementById("lowfps-msg"),p=0==this.difficulty?"casual":"hard",q=this.hud.timeSeparators,r=bkcore.Timer.msToTimeString(a),s=[bkcore.Timer.msToTimeString(b[0]),bkcore.Timer.msToTimeString(b[1]),bkcore.Timer.msToTimeString(b[2])];if(this.gameplay.result==this.gameplay.results.FINISH){void 0!=e&&(e.innerHTML="Finished!"),"undefined"!=typeof Storage&&(void 0==localStorage["score-"+c+"-"+p]||localStorage["score-"+c+"-"+p]>a?(void 0!=g&&(g.innerHTML="New local record!"),localStorage["score-"+c+"-"+p]=a):void 0!=g&&(g.innerHTML="Well done!"));var t=bkcore.hexgl.Ladder.global[c][p][bkcore.hexgl.Ladder.global[c][p].length-2];void 0!=t&&t.score>a?void 0!=f&&(f.innerHTML="You made it to the HOF!"):void 0!=f&&(f.innerHTML="Hall Of Fame"),void 0!=h&&(h.innerHTML=r.m+q[1]+r.s+q[2]+r.ms),void 0!=i&&(i.innerHTML=void 0!=s[0].m?s[0].m+q[1]+s[0].s+q[2]+s[0].ms:"-"),void 0!=j&&(j.innerHTML=void 0!=s[1].m?s[1].m+q[1]+s[1].s+q[2]+s[1].ms:"-"),void 0!=k&&(k.innerHTML=void 0!=s[2].m?s[2].m+q[1]+s[2].s+q[2]+s[2].ms:"-")}else void 0!=e&&(e.innerHTML="Destroyed!"),void 0!=g&&(g.innerHTML="Maybe next time!"),void 0!=f&&(f.innerHTML="Hall Of Fame"),void 0!=h&&(h.innerHTML="None"),void 0!=i&&(i.innerHTML="None"),void 0!=j&&(j.innerHTML="None"),void 0!=k&&(k.innerHTML="None");void 0!=l&&(l.innerHTML=p),void 0!=m&&(m.href="http://twitter.com/share?text="+encodeURIComponent("I just scored "+h.innerHTML+" in Cityscape ("+p+") on #HexGL! Come try it and beat my record on ")),void 0!=n&&(n.href="http://www.facebook.com/sharer.php?s=100&p[title]="+encodeURIComponent("I just scored "+h.innerHTML+" in Cityscape ("+p+") on HexGL!")+"&p[summary]="+encodeURIComponent("HexGL is a futuristic racing game built by Thibaut Despoulain (BKcore) using HTML5, Javascript and WebGL. Come challenge your friends on this fast-paced 3D game!")+"&p[url]="+encodeURIComponent("http://hexgl.bkcore.com")+"&p[images][0]="+encodeURIComponent("http://hexgl.bkcore.com/image.png")),bkcore.Ladder.displayLadder("finish-ladder",c,p,8),this.manager.get("game").objects.lowFPS>=999?void 0!=o&&(o.innerHTML="アドバイス：フレームレートがかなり低下していました。画質を落としてみてください。<br>Note: Your framerate was pretty low, you should try a lesser graphic setting!"):void 0!=o&&(o.innerHTML=""),d.style.display="block"},bkcore.hexgl.HexGL.prototype.initRenderer=function(){var a=new THREE.WebGLRenderer({antialias:!1,clearColor:0});a.physicallyBasedShading=!0,a.gammaInput=!0,a.gammaOutput=!0,a.shadowMapEnabled=!0,a.shadowMapSoft=!0,a.autoClear=!1,a.sortObjects=!1,a.setSize(this.width,this.height),a.domElement.style.position="relative",this.containers.main.appendChild(a.domElement),this.renderer=a,this.manager=new bkcore.threejs.RenderManager(a)},bkcore.hexgl.HexGL.prototype.initHUD=function(){this.hud=new bkcore.hexgl.HUD({width:this.width,height:this.height,font:"BebasNeueRegular",bg:this.track.lib.get("images","hud.bg"),speed:this.track.lib.get("images","hud.speed"),shield:this.track.lib.get("images","hud.shield")}),this.containers.overlay.appendChild(this.hud.canvas)},bkcore.hexgl.HexGL.prototype.initGameComposer=function(){var a={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},b=new THREE.WebGLRenderTarget(this.width,this.height,a),c=new THREE.RenderPass(this.manager.get("sky").scene,this.manager.get("sky").camera),d=new THREE.RenderPass(this.manager.get("game").scene,this.manager.get("game").camera);d.clear=!1,this.composers.game=new THREE.EffectComposer(this.renderer,b);var e=(new THREE.ShaderPass(THREE.ShaderExtras.screen),new THREE.ShaderPass(THREE.ShaderExtras.vignette),new THREE.ShaderPass(bkcore.threejs.Shaders.hexvignette));if(e.uniforms.size.value=512*(this.width/1633),e.uniforms.rx.value=this.width,e.uniforms.ry.value=this.height,e.uniforms.tHex.texture=this.track.lib.get("textures","hex"),e.uniforms.color.value=this.extras.vignetteColor,e.renderToScreen=!0,this.composers.game.addPass(c),this.composers.game.addPass(d),this.quality>0){var f=new THREE.ShaderPass(THREE.ShaderExtras.fxaa);f.uniforms.resolution.value.set(1/this.width,1/this.height),this.composers.game.addPass(f),this.extras.fxaa=f}if(this.quality>1){var g=new THREE.BloomPass(.8,25,4,256);this.composers.game.addPass(g),this.extras.bloom=g}this.composers.game.addPass(e)},bkcore.hexgl.HexGL.prototype.createMesh=function(a,b,c,d,e,f){b.computeTangents();var g=new THREE.Mesh(b,f);return g.position.set(c,d,e),a.add(g),this.quality>0&&(g.castShadow=!0,g.receiveShadow=!0),g},bkcore.hexgl.HexGL.prototype.tweakShipControls=function(){var a=this.components.shipControls;1==this.difficulty?(a.airResist=.035,a.airDrift=.07,a.thrust=.035,a.airBrake=.04,a.maxSpeed=9.6,a.boosterSpeed=.35*a.maxSpeed,a.boosterDecay=.007,a.angularSpeed=.014,a.airAngularSpeed=.0165,a.rollAngle=.6,a.shieldDamage=.03,a.collisionSpeedDecrease=.8,a.collisionSpeedDecreaseCoef=.5,a.rollLerp=.1,a.driftLerp=.4,a.angularLerp=.4):0==this.difficulty&&(a.airResist=.02,a.airDrift=.06,a.thrust=.02,a.airBrake=.025,a.maxSpeed=7,a.boosterSpeed=.5*a.maxSpeed,a.boosterDecay=.007,a.angularSpeed=.0125,a.airAngularSpeed=.0135,a.rollAngle=.6,a.shieldDamage=.06,a.collisionSpeedDecrease=.8,a.collisionSpeedDecreaseCoef=.5,a.rollLerp=.07,a.driftLerp=.3,a.angularLerp=.4)};
//# sourceMappingURL=HexGL.map