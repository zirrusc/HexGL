var bkcore=bkcore||{};bkcore.hexgl=bkcore.hexgl||{},bkcore.hexgl.ShipControls=function(a){function b(a){switch(a.keyCode){case 38:d.key.forward=!0;break;case 40:d.key.backward=!0;break;case 37:d.key.left=!0;break;case 39:d.key.right=!0;break;case 81:d.key.ltrigger=!0;break;case 65:d.key.ltrigger=!0;break;case 68:d.key.rtrigger=!0;break;case 69:d.key.rtrigger=!0}}function c(a){switch(a.keyCode){case 38:d.key.forward=!1;break;case 40:d.key.backward=!1;break;case 37:d.key.left=!1;break;case 39:d.key.right=!1;break;case 81:d.key.ltrigger=!1;break;case 65:d.key.ltrigger=!1;break;case 68:d.key.rtrigger=!1;break;case 69:d.key.rtrigger=!1}}var d=this;this.active=!0,this.destroyed=!1,this.dom=a,this.mesh=null,this.epsilon=1e-8,this.zero=new THREE.Vector3(0,0,0),this.airResist=.002,this.airDrift=.1,this.thrust=.02,this.airBrake=.02,this.maxSpeed=7,this.boosterSpeed=.4*this.maxSpeed,this.boosterDecay=.01,this.angularSpeed=.005,this.airAngularSpeed=.0065,this.repulsionRatio=.5,this.repulsionCap=2.5,this.repulsionLerp=.1,this.collisionSpeedDecrease=.8,this.collisionSpeedDecreaseCoef=.8,this.maxShield=5,this.shieldDelay=60,this.shieldTiming=0,this.shieldDamage=.25,this.driftLerp=.35,this.angularLerp=.35,this.movement=new THREE.Vector3(0,0,0),this.rotation=new THREE.Vector3(0,0,0),this.roll=0,this.rollAxis=new THREE.Vector3,this.drift=0,this.speed=0,this.speedRatio=0,this.boost=0,this.shield=1,this.angular=0,this.currentVelocity=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.dummy=new THREE.Object3D,this.dummy.useQuaternion=!0,this.collisionMap=null,this.collisionPixelRatio=1,this.collisionDetection=!1,this.collisionPreviousPosition=new THREE.Vector3,this.heightMap=null,this.heightPixelRatio=1,this.heightBias=0,this.heightLerp=.4,this.heightScale=1,this.rollAngle=.6,this.rollLerp=.08,this.rollDirection=new THREE.Vector3(0,0,1),this.gradient=0,this.gradientTarget=0,this.gradientLerp=.05,this.gradientScale=4,this.gradientVector=new THREE.Vector3(0,0,5),this.gradientAxis=new THREE.Vector3(1,0,0),this.tilt=0,this.tiltTarget=0,this.tiltLerp=.05,this.tiltScale=4,this.tiltVector=new THREE.Vector3(5,0,0),this.tiltAxis=new THREE.Vector3(0,0,1),this.repulsionVLeft=new THREE.Vector3(1,0,0),this.repulsionVRight=new THREE.Vector3(-1,0,0),this.repulsionVFront=new THREE.Vector3(0,0,1),this.repulsionVScale=4,this.repulsionAmount=0,this.repulsionForce=new THREE.Vector3,this.resetPos=null,this.resetRot=null,this.key={forward:!1,backward:!1,left:!1,right:!1,ltrigger:!1,rtrigger:!1,use:!1},this.collision={front:!1,left:!1,right:!1},a.addEventListener("keydown",b,!1),a.addEventListener("keyup",c,!1)},bkcore.hexgl.ShipControls.prototype.control=function(a){this.mesh=a,this.mesh.martixAutoUpdate=!1,this.dummy.position=this.mesh.position},bkcore.hexgl.ShipControls.prototype.reset=function(a,b){this.resetPos=a,this.resetRot=b,this.movement.set(0,0,0),this.rotation.copy(b),this.roll=0,this.drift=0,this.speed=0,this.speedRatio=0,this.boost=0,this.shield=this.maxShield,this.destroyed=!1,this.dummy.position.copy(a),this.quaternion.set(b.x,b.y,b.z,1).normalize(),this.dummy.quaternion.set(0,0,0,1),this.dummy.quaternion.multiplySelf(this.quaternion),this.dummy.matrix.setPosition(this.dummy.position),this.dummy.matrix.setRotationFromQuaternion(this.dummy.quaternion),this.mesh.matrix.identity(),this.mesh.applyMatrix(this.dummy.matrix)},bkcore.hexgl.ShipControls.prototype.destroy=function(){this.active=!1,this.destroyed=!0,this.collision.front=!1,this.collision.left=!1,this.collision.right=!1},bkcore.hexgl.ShipControls.prototype.update=function(a){if(this.active){this.rotation.y=0,this.movement.set(0,0,0),this.drift+=(0-this.drift)*this.driftLerp,this.angular+=(0-this.angular)*this.angularLerp*.5;var b=0,c=0;if(this.key.forward?this.speed+=this.thrust*a:this.speed-=this.airResist*a,this.key.backward&&(this.speed-=this.thrust*a),this.key.left&&(c+=this.angularSpeed*a,b-=this.rollAngle),this.key.right&&(c-=this.angularSpeed*a,b+=this.rollAngle),this.key.ltrigger&&(c+=this.key.left?this.airAngularSpeed*a:.5*this.airAngularSpeed*a,this.speed-=this.airBrake*a,this.drift+=(this.airDrift-this.drift)*this.driftLerp,this.movement.x+=this.speed*this.drift*a,this.drift>0&&(this.movement.z-=this.speed*this.drift*a),b-=.7*this.rollAngle),this.key.rtrigger&&(c-=this.key.right?this.airAngularSpeed*a:.5*this.airAngularSpeed*a,this.speed-=this.airBrake*a,this.drift+=(-this.airDrift-this.drift)*this.driftLerp,this.movement.x+=this.speed*this.drift*a,this.drift<0&&(this.movement.z+=this.speed*this.drift*a),b+=.7*this.rollAngle),0!=mobile.Direction&&(c+=mobile.Direction*a,b+=-this.rollAngle*mobile.Direction/this.angularSpeed,mobile.Direction=0),0!=mobile.Forward&&(this.speed+=mobile.Forward*a),this.angular+=(c-this.angular)*this.angularLerp,this.rotation.y=this.angular,this.speed=Math.max(0,Math.min(this.speed,this.maxSpeed)),this.speedRatio=this.speed/this.maxSpeed,this.movement.z+=this.speed*a,this.repulsionForce.isZero()?this.repulsionForce.set(0,0,0):(0!=this.repulsionForce.z&&(this.movement.z=0),this.movement.addSelf(this.repulsionForce),this.repulsionForce.lerpSelf(this.zero,a>1.5?2*this.repulsionLerp:this.repulsionLerp)),this.collisionPreviousPosition.copy(this.dummy.position),this.boosterCheck(a),this.dummy.translateX(this.movement.x),this.dummy.translateZ(this.movement.z),this.heightCheck(a),this.dummy.translateY(this.movement.y),this.currentVelocity.copy(this.dummy.position).subSelf(this.collisionPreviousPosition),this.collisionCheck(a),this.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,1).normalize(),this.dummy.quaternion.multiplySelf(this.quaternion),this.dummy.matrix.setPosition(this.dummy.position),this.dummy.matrix.setRotationFromQuaternion(this.dummy.quaternion),this.shield<=0&&(this.shield=0,this.destroy()),null!=this.mesh){this.mesh.matrix.identity();var d=(this.gradientTarget-this.gradient)*this.gradientLerp;Math.abs(d)>this.epsilon&&(this.gradient+=d),Math.abs(this.gradient)>this.epsilon&&(this.gradientAxis.set(1,0,0),this.mesh.matrix.rotateByAxis(this.gradientAxis,this.gradient));var e=(this.tiltTarget-this.tilt)*this.tiltLerp;Math.abs(e)>this.epsilon&&(this.tilt+=e),Math.abs(this.tilt)>this.epsilon&&(this.tiltAxis.set(0,0,1),this.mesh.matrix.rotateByAxis(this.tiltAxis,this.tilt));var f=(b-this.roll)*this.rollLerp;Math.abs(f)>this.epsilon&&(this.roll+=f),Math.abs(this.roll)>this.epsilon&&(this.rollAxis.copy(this.rollDirection),this.mesh.matrix.rotateByAxis(this.rollAxis,this.roll)),this.mesh.applyMatrix(this.dummy.matrix),this.mesh.updateMatrixWorld(!0)}}},bkcore.hexgl.ShipControls.prototype.boosterCheck=function(a){if(!this.collisionMap||!this.collisionMap.loaded)return!1;this.boost-=this.boosterDecay*a,this.boost<0&&(this.boost=0);var b=Math.round(this.collisionMap.pixels.width/2+this.dummy.position.x*this.collisionPixelRatio),c=Math.round(this.collisionMap.pixels.height/2+this.dummy.position.z*this.collisionPixelRatio),d=(new THREE.Vector3(b,0,c),this.collisionMap.getPixel(b,c));255==d.r&&d.g<127&&d.b<127&&(this.boost=this.boosterSpeed),this.movement.z+=this.boost*a},bkcore.hexgl.ShipControls.prototype.collisionCheck=function(a){if(!this.collisionDetection||!this.collisionMap||!this.collisionMap.loaded)return!1;this.shieldDelay>0&&(this.shieldDelay-=a),this.collision.left=!1,this.collision.right=!1,this.collision.front=!1;var b=Math.round(this.collisionMap.pixels.width/2+this.dummy.position.x*this.collisionPixelRatio),c=Math.round(this.collisionMap.pixels.height/2+this.dummy.position.z*this.collisionPixelRatio),d=new THREE.Vector3(b,0,c),e=this.collisionMap.getPixelBilinear(b,c);if(e.r<255){var f=this.getRealSpeed()/this.maxSpeed;this.shield-=f*f*.8*this.shieldDamage,this.repulsionVLeft.set(1,0,0),this.repulsionVRight.set(-1,0,0),this.dummy.matrix.rotateAxis(this.repulsionVLeft),this.dummy.matrix.rotateAxis(this.repulsionVRight),this.repulsionVLeft.multiplyScalar(this.repulsionVScale),this.repulsionVRight.multiplyScalar(this.repulsionVScale);var g=this.repulsionVLeft.addSelf(d),h=this.repulsionVRight.addSelf(d),i=this.collisionMap.getPixel(Math.round(g.x),Math.round(g.z)).r,j=this.collisionMap.getPixel(Math.round(h.x),Math.round(h.z)).r;return this.repulsionAmount=Math.max(.8,Math.min(this.repulsionCap,this.speed*this.repulsionRatio)),j>i?(this.repulsionForce.x+=-this.repulsionAmount,this.collision.left=!0):i>j?(this.repulsionForce.x+=this.repulsionAmount,this.collision.right=!0):(this.repulsionForce.z+=4*-this.repulsionAmount,this.collision.front=!0,this.speed=0),this.speed*=this.collisionSpeedDecrease,this.speed*=1-this.collisionSpeedDecreaseCoef*(1-e.r/255),this.boost=0,!0}return!1},bkcore.hexgl.ShipControls.prototype.heightCheck=function(){if(!this.heightMap||!this.heightMap.loaded)return!1;{var a=this.heightMap.pixels.width/2+this.dummy.position.x*this.heightPixelRatio,b=this.heightMap.pixels.height/2+this.dummy.position.z*this.heightPixelRatio,c=this.heightMap.getPixelFBilinear(a,b)/this.heightScale+this.heightBias;this.heightMap.getPixel(a,b)}if(16777>c){var d=c-this.dummy.position.y;this.movement.y+=d>0?d:d*this.heightLerp}this.gradientVector.set(0,0,5),this.dummy.matrix.rotateAxis(this.gradientVector),this.gradientVector.addSelf(this.dummy.position),a=this.heightMap.pixels.width/2+this.gradientVector.x*this.heightPixelRatio,b=this.heightMap.pixels.height/2+this.gradientVector.z*this.heightPixelRatio;var e=this.heightMap.getPixelFBilinear(a,b)/this.heightScale+this.heightBias;16777>e&&(this.gradientTarget=-Math.atan2(e-c,5)*this.gradientScale),this.tiltVector.set(5,0,0),this.dummy.matrix.rotateAxis(this.tiltVector),this.tiltVector.addSelf(this.dummy.position),a=this.heightMap.pixels.width/2+this.tiltVector.x*this.heightPixelRatio,b=this.heightMap.pixels.height/2+this.tiltVector.z*this.heightPixelRatio,e=this.heightMap.getPixelFBilinear(a,b)/this.heightScale+this.heightBias,e>=16777&&(this.tiltVector.subSelf(this.dummy.position).multiplyScalar(-1).addSelf(this.dummy.position),a=this.heightMap.pixels.width/2+this.tiltVector.x*this.heightPixelRatio,b=this.heightMap.pixels.height/2+this.tiltVector.z*this.heightPixelRatio,e=this.heightMap.getPixelFBilinear(a,b)/this.heightScale+this.heightBias),16777>e&&(this.tiltTarget=Math.atan2(e-c,5)*this.tiltScale)},bkcore.hexgl.ShipControls.prototype.getRealSpeed=function(a){return Math.round((this.speed+this.boost)*(void 0==a?1:a))},bkcore.hexgl.ShipControls.prototype.getRealSpeedRatio=function(){return Math.min(this.maxSpeed,this.speed+this.boost)/this.maxSpeed},bkcore.hexgl.ShipControls.prototype.getSpeedRatio=function(){return(this.speed+this.boost)/this.maxSpeed},bkcore.hexgl.ShipControls.prototype.getBoostRatio=function(){return this.boost/this.boosterSpeed},bkcore.hexgl.ShipControls.prototype.getShieldRatio=function(){return this.shield/this.maxShield},bkcore.hexgl.ShipControls.prototype.getShield=function(a){return Math.round(this.shield*(void 0==a?1:a))};var bkcore=bkcore||{};bkcore.hexgl=bkcore.hexgl||{},bkcore.hexgl.ShipControls=function(a){function b(a){switch(a.keyCode){case 38:d.key.forward=!0;break;case 40:d.key.backward=!0;break;case 37:d.key.left=!0;break;case 39:d.key.right=!0;break;case 81:d.key.ltrigger=!0;break;case 65:d.key.ltrigger=!0;break;case 68:d.key.rtrigger=!0;break;case 69:d.key.rtrigger=!0}}function c(a){switch(a.keyCode){case 38:d.key.forward=!1;break;case 40:d.key.backward=!1;break;case 37:d.key.left=!1;break;case 39:d.key.right=!1;break;case 81:d.key.ltrigger=!1;break;case 65:d.key.ltrigger=!1;break;case 68:d.key.rtrigger=!1;break;case 69:d.key.rtrigger=!1}}var d=this;this.active=!0,this.destroyed=!1,this.dom=a,this.mesh=null,this.epsilon=1e-8,this.zero=new THREE.Vector3(0,0,0),this.airResist=.02,this.airDrift=.1,this.thrust=.02,this.airBrake=.02,this.maxSpeed=7,this.boosterSpeed=.4*this.maxSpeed,this.boosterDecay=.01,this.angularSpeed=.005,this.airAngularSpeed=.0065,this.repulsionRatio=.5,this.repulsionCap=2.5,this.repulsionLerp=.1,this.collisionSpeedDecrease=.8,this.collisionSpeedDecreaseCoef=.8,this.maxShield=1,this.shieldDelay=60,this.shieldTiming=0,this.shieldDamage=.25,this.driftLerp=.35,this.angularLerp=.35,this.movement=new THREE.Vector3(0,0,0),this.rotation=new THREE.Vector3(0,0,0),this.roll=0,this.rollAxis=new THREE.Vector3,this.drift=0,this.speed=0,this.speedRatio=0,this.boost=0,this.shield=1,this.angular=0,this.currentVelocity=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.dummy=new THREE.Object3D,this.dummy.useQuaternion=!0,this.collisionMap=null,this.collisionPixelRatio=1,this.collisionDetection=!1,this.collisionPreviousPosition=new THREE.Vector3,this.heightMap=null,this.heightPixelRatio=1,this.heightBias=0,this.heightLerp=.4,this.heightScale=1,this.rollAngle=.6,this.rollLerp=.08,this.rollDirection=new THREE.Vector3(0,0,1),this.gradient=0,this.gradientTarget=0,this.gradientLerp=.05,this.gradientScale=4,this.gradientVector=new THREE.Vector3(0,0,5),this.gradientAxis=new THREE.Vector3(1,0,0),this.tilt=0,this.tiltTarget=0,this.tiltLerp=.05,this.tiltScale=4,this.tiltVector=new THREE.Vector3(5,0,0),this.tiltAxis=new THREE.Vector3(0,0,1),this.repulsionVLeft=new THREE.Vector3(1,0,0),this.repulsionVRight=new THREE.Vector3(-1,0,0),this.repulsionVFront=new THREE.Vector3(0,0,1),this.repulsionVScale=4,this.repulsionAmount=0,this.repulsionForce=new THREE.Vector3,this.resetPos=null,this.resetRot=null,this.key={forward:!1,backward:!1,left:!1,right:!1,ltrigger:!1,rtrigger:!1,use:!1},this.collision={front:!1,left:!1,right:!1},a.addEventListener("keydown",b,!1),a.addEventListener("keyup",c,!1)},bkcore.hexgl.ShipControls.prototype.control=function(a){this.mesh=a,this.mesh.martixAutoUpdate=!1,this.dummy.position=this.mesh.position},bkcore.hexgl.ShipControls.prototype.reset=function(a,b){this.resetPos=a,this.resetRot=b,this.movement.set(0,0,0),this.rotation.copy(b),this.roll=0,this.drift=0,this.speed=0,this.speedRatio=0,this.boost=0,this.shield=this.maxShield,this.destroyed=!1,this.dummy.position.copy(a),this.quaternion.set(b.x,b.y,b.z,1).normalize(),this.dummy.quaternion.set(0,0,0,1),this.dummy.quaternion.multiplySelf(this.quaternion),this.dummy.matrix.setPosition(this.dummy.position),this.dummy.matrix.setRotationFromQuaternion(this.dummy.quaternion),this.mesh.matrix.identity(),this.mesh.applyMatrix(this.dummy.matrix)},bkcore.hexgl.ShipControls.prototype.destroy=function(){this.active=!1,this.destroyed=!0,this.collision.front=!1,this.collision.left=!1,this.collision.right=!1},bkcore.hexgl.ShipControls.prototype.update=function(a){if(this.active){this.rotation.y=0,this.movement.set(0,0,0),this.drift+=(0-this.drift)*this.driftLerp,this.angular+=(0-this.angular)*this.angularLerp*.5;var b=0,c=0;if(this.key.forward?this.speed+=this.thrust*a:this.speed-=this.airResist*a,this.key.left&&(c+=this.angularSpeed*a,b-=this.rollAngle),this.key.right&&(c-=this.angularSpeed*a,b+=this.rollAngle),this.key.ltrigger&&(c+=this.key.left?this.airAngularSpeed*a:.5*this.airAngularSpeed*a,this.speed-=this.airBrake*a,this.drift+=(this.airDrift-this.drift)*this.driftLerp,this.movement.x+=this.speed*this.drift*a,this.drift>0&&(this.movement.z-=this.speed*this.drift*a),b-=.7*this.rollAngle),this.key.rtrigger&&(c-=this.key.right?this.airAngularSpeed*a:.5*this.airAngularSpeed*a,this.speed-=this.airBrake*a,this.drift+=(-this.airDrift-this.drift)*this.driftLerp,this.movement.x+=this.speed*this.drift*a,this.drift<0&&(this.movement.z+=this.speed*this.drift*a),b+=.7*this.rollAngle),this.angular+=(c-this.angular)*this.angularLerp,this.rotation.y=this.angular,this.speed=Math.max(0,Math.min(this.speed,this.maxSpeed)),this.speedRatio=this.speed/this.maxSpeed,this.movement.z+=this.speed*a,this.repulsionForce.isZero()?this.repulsionForce.set(0,0,0):(0!=this.repulsionForce.z&&(this.movement.z=0),this.movement.addSelf(this.repulsionForce),this.repulsionForce.lerpSelf(this.zero,a>1.5?2*this.repulsionLerp:this.repulsionLerp)),this.collisionPreviousPosition.copy(this.dummy.position),this.boosterCheck(a),this.dummy.translateX(this.movement.x),this.dummy.translateZ(this.movement.z),this.heightCheck(a),this.dummy.translateY(this.movement.y),this.currentVelocity.copy(this.dummy.position).subSelf(this.collisionPreviousPosition),this.collisionCheck(a),this.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,1).normalize(),this.dummy.quaternion.multiplySelf(this.quaternion),this.dummy.matrix.setPosition(this.dummy.position),this.dummy.matrix.setRotationFromQuaternion(this.dummy.quaternion),this.shield<=0&&(this.shield=0,this.destroy()),null!=this.mesh){this.mesh.matrix.identity();var d=(this.gradientTarget-this.gradient)*this.gradientLerp;Math.abs(d)>this.epsilon&&(this.gradient+=d),Math.abs(this.gradient)>this.epsilon&&(this.gradientAxis.set(1,0,0),this.mesh.matrix.rotateByAxis(this.gradientAxis,this.gradient));var e=(this.tiltTarget-this.tilt)*this.tiltLerp;Math.abs(e)>this.epsilon&&(this.tilt+=e),Math.abs(this.tilt)>this.epsilon&&(this.tiltAxis.set(0,0,1),this.mesh.matrix.rotateByAxis(this.tiltAxis,this.tilt));var f=(b-this.roll)*this.rollLerp;Math.abs(f)>this.epsilon&&(this.roll+=f),Math.abs(this.roll)>this.epsilon&&(this.rollAxis.copy(this.rollDirection),this.mesh.matrix.rotateByAxis(this.rollAxis,this.roll)),this.mesh.applyMatrix(this.dummy.matrix),this.mesh.updateMatrixWorld(!0)}}},bkcore.hexgl.ShipControls.prototype.boosterCheck=function(a){if(!this.collisionMap||!this.collisionMap.loaded)return!1;this.boost-=this.boosterDecay*a,this.boost<0&&(this.boost=0);var b=Math.round(this.collisionMap.pixels.width/2+this.dummy.position.x*this.collisionPixelRatio),c=Math.round(this.collisionMap.pixels.height/2+this.dummy.position.z*this.collisionPixelRatio),d=(new THREE.Vector3(b,0,c),this.collisionMap.getPixel(b,c));255==d.r&&d.g<127&&d.b<127&&(this.boost=this.boosterSpeed),this.movement.z+=this.boost*a},bkcore.hexgl.ShipControls.prototype.collisionCheck=function(a){if(!this.collisionDetection||!this.collisionMap||!this.collisionMap.loaded)return!1;this.shieldDelay>0&&(this.shieldDelay-=a),this.collision.left=!1,this.collision.right=!1,this.collision.front=!1;var b=Math.round(this.collisionMap.pixels.width/2+this.dummy.position.x*this.collisionPixelRatio),c=Math.round(this.collisionMap.pixels.height/2+this.dummy.position.z*this.collisionPixelRatio),d=new THREE.Vector3(b,0,c),e=this.collisionMap.getPixelBilinear(b,c);if(e.r<255){var f=this.getRealSpeed()/this.maxSpeed;this.shield-=f*f*.8*this.shieldDamage,this.repulsionVLeft.set(1,0,0),this.repulsionVRight.set(-1,0,0),this.dummy.matrix.rotateAxis(this.repulsionVLeft),this.dummy.matrix.rotateAxis(this.repulsionVRight),this.repulsionVLeft.multiplyScalar(this.repulsionVScale),this.repulsionVRight.multiplyScalar(this.repulsionVScale);var g=this.repulsionVLeft.addSelf(d),h=this.repulsionVRight.addSelf(d),i=this.collisionMap.getPixel(Math.round(g.x),Math.round(g.z)).r,j=this.collisionMap.getPixel(Math.round(h.x),Math.round(h.z)).r;return this.repulsionAmount=Math.max(.8,Math.min(this.repulsionCap,this.speed*this.repulsionRatio)),j>i?(this.repulsionForce.x+=-this.repulsionAmount,this.collision.left=!0):i>j?(this.repulsionForce.x+=this.repulsionAmount,this.collision.right=!0):(this.repulsionForce.z+=4*-this.repulsionAmount,this.collision.front=!0,this.speed=0),this.speed*=this.collisionSpeedDecrease,this.speed*=1-this.collisionSpeedDecreaseCoef*(1-e.r/255),this.boost=0,!0}return!1},bkcore.hexgl.ShipControls.prototype.heightCheck=function(){if(!this.heightMap||!this.heightMap.loaded)return!1;{var a=this.heightMap.pixels.width/2+this.dummy.position.x*this.heightPixelRatio,b=this.heightMap.pixels.height/2+this.dummy.position.z*this.heightPixelRatio,c=this.heightMap.getPixelFBilinear(a,b)/this.heightScale+this.heightBias;this.heightMap.getPixel(a,b)}if(16777>c){var d=c-this.dummy.position.y;this.movement.y+=d>0?d:d*this.heightLerp}this.gradientVector.set(0,0,5),this.dummy.matrix.rotateAxis(this.gradientVector),this.gradientVector.addSelf(this.dummy.position),a=this.heightMap.pixels.width/2+this.gradientVector.x*this.heightPixelRatio,b=this.heightMap.pixels.height/2+this.gradientVector.z*this.heightPixelRatio;var e=this.heightMap.getPixelFBilinear(a,b)/this.heightScale+this.heightBias;16777>e&&(this.gradientTarget=-Math.atan2(e-c,5)*this.gradientScale),this.tiltVector.set(5,0,0),this.dummy.matrix.rotateAxis(this.tiltVector),this.tiltVector.addSelf(this.dummy.position),a=this.heightMap.pixels.width/2+this.tiltVector.x*this.heightPixelRatio,b=this.heightMap.pixels.height/2+this.tiltVector.z*this.heightPixelRatio,e=this.heightMap.getPixelFBilinear(a,b)/this.heightScale+this.heightBias,e>=16777&&(this.tiltVector.subSelf(this.dummy.position).multiplyScalar(-1).addSelf(this.dummy.position),a=this.heightMap.pixels.width/2+this.tiltVector.x*this.heightPixelRatio,b=this.heightMap.pixels.height/2+this.tiltVector.z*this.heightPixelRatio,e=this.heightMap.getPixelFBilinear(a,b)/this.heightScale+this.heightBias),16777>e&&(this.tiltTarget=Math.atan2(e-c,5)*this.tiltScale)},bkcore.hexgl.ShipControls.prototype.getRealSpeed=function(a){return Math.round((this.speed+this.boost)*(void 0==a?1:a))},bkcore.hexgl.ShipControls.prototype.getRealSpeedRatio=function(){return Math.min(this.maxSpeed,this.speed+this.boost)/this.maxSpeed},bkcore.hexgl.ShipControls.prototype.getSpeedRatio=function(){return(this.speed+this.boost)/this.maxSpeed},bkcore.hexgl.ShipControls.prototype.getBoostRatio=function(){return this.boost/this.boosterSpeed},bkcore.hexgl.ShipControls.prototype.getShieldRatio=function(){return this.shield/this.maxShield},bkcore.hexgl.ShipControls.prototype.getShield=function(a){return Math.round(this.shield*(void 0==a?1:a))};
//# sourceMappingURL=ShipControls.map